@using Infrastructure.Models.AHP
@model AHPViewModel
@{
    // Xác định sản phẩm bán chạy nhất
    var bestSeller = Model.Products.OrderByDescending(p => p.Sold).FirstOrDefault();
}

<div class="container py-4">
    <!-- Hàng 1: Hiển thị sản phẩm -->
    <div class="row g-4 mb-4">
        @foreach (var product in Model.Products)
        {
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                <div class="card h-100 shadow-sm position-relative product-card">
                    @if (bestSeller != null && product.Id == bestSeller.Id && bestSeller.Sold > 0)
                    {
                        <span class="badge best-seller-badge position-absolute top-0 start-0 m-2" style="z-index:10;">
                            <i class="fa fa-crown me-1 text-warning"></i> Best Seller
                        </span>
                    }
                    <img onerror="this.src='/images/not-found.png'" src="/uploads/products/@product.ImageUrl" class="card-img-top product-img" alt="@product.Name" style="object-fit:cover; height:180px;">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title text-truncate" title="@product.Name">@product.Name</h5>
                        <div class="mb-2">
                            <span class="fw-bold text-success">@product.Price.ToString("N0")₫</span>
                            @if (product.OldPrice > product.Price)
                            {
                                <span class="text-decoration-line-through text-muted ms-2">@product.OldPrice.ToString("N0")₫</span>
                            }
                        </div>
                        <div class="mb-2 small text-secondary">
                            <i class="fa fa-box"></i> Đã bán: <span class="fw-bold">@product.Sold</span>
                        </div>
                        @* <div class="mb-2">
                            <span class="text-warning">
                                @for (int i = 0; i < Math.Round(product.Sold > 0 ? 5 : 0); i++)
                                {
                                    <i class="fa fa-star"></i>
                                }
                                @for (int i = (int)Math.Round(product.Sold > 0 ? 5 : 0); i < 5; i++)
                                {
                                    <i class="fa fa-star text-muted"></i>
                                }
                            </span>
                        </div> *@
                        <a href="/Product/@product.Id" class="btn btn-outline-primary mt-auto">Xem chi tiết</a>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Hàng 2: Khung đánh giá tổng quan -->
    <div class="row">
        <div class="col-12">
            <div class="overview-box p-4 rounded-4 shadow-lg bg-gradient position-relative mb-4" style="background: linear-gradient(120deg, #f8fafc 60%, #e0c3fc 100%);">
                <h4 class="mb-3 fw-bold text-primary"><i class="fa fa-chart-line me-2"></i>Đánh giá tổng quan xu hướng sản phẩm</h4>
                <ul class="list-unstyled mb-0">
                    @foreach (var product in Model.Products)
                    {
                        <li class="mb-3 d-flex align-items-start overview-item">
                            <span class="me-3 fs-3">
                                @if (bestSeller != null && product.Id == bestSeller.Id && bestSeller.Sold > 0)
                                {
                                    <i class="fa fa-crown text-warning"></i>
                                }
                                else if (product.Sold == 0)
                                {
                                    <i class="fa fa-arrow-down text-danger"></i>
                                }
                                else
                                {
                                    <i class="fa fa-star text-info"></i>
                                }
                            </span>
                            <div>
                                <span class="fw-semibold">@product.Name:</span>
                                @if (bestSeller != null && product.Id == bestSeller.Id && bestSeller.Sold > 0)
                                {
                                    <span class="text-success"> Sản lượng bán được cao nhất, nhận về đánh giá tốt từ người dùng, được yêu thích và đáp ứng nhu cầu người dùng nên nên tăng số lượng nhập kho.</span>
                                }
                                else if (product.Sold == 0)
                                {
                                    <span class="text-danger"> Bán kém, chưa có đánh giá, nên có các voucher giảm giá để thu hút khách hàng.</span>
                                }
                                else if (product.Sold < 10)
                                {
                                    <span class="text-warning"> Sản lượng bán còn thấp, cần đẩy mạnh quảng bá hoặc tặng kèm ưu đãi.</span>
                                }
                                else
                                {
                                    <span class="text-info"> Được người dùng quan tâm, đánh giá ổn, nên duy trì chất lượng và dịch vụ.</span>
                                }
                            </div>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        .best-seller-badge {
            font-size: 1rem;
            font-weight: 700;
            background: linear-gradient(90deg, #ffd700 60%, #fffbe6 100%);
            color: #333;
            box-shadow: 0 2px 8px #ffd70080;
            border-radius: 1rem 0.5rem 1rem 0.5rem;
            padding: 0.4em 1.2em 0.4em 1.5em;
            z-index: 10;
            left: 0;
            top: 0;
            display: flex;
            align-items: center;
            min-width: 120px;
        }
        .best-seller-badge i {
            font-size: 1.2em;
            margin-right: 0.4em;
        }
        .product-card {
            overflow: visible;
        }
        .product-img {
            border-radius: 1rem 1rem 0 0;
            background: #fff;
        }
        .overview-box {
            background: linear-gradient(120deg, #f8fafc 60%, #e0c3fc 100%) !important;
            border: 2px solid #e0c3fc;
        }
        .overview-item i {
            min-width: 32px;
        }
        .overview-item {
            border-left: 4px solid #a18cd1;
            padding-left: 1rem;
            background: rgba(255,255,255,0.7);
            border-radius: 0.5rem;
            transition: box-shadow 0.2s;
        }
        .overview-item:hover {
            box-shadow: 0 2px 12px #a18cd1a0;
        }
    </style>
}
